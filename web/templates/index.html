{% extends "base.html" %}

{% block content %}
<div class="row mb-3">
    <div class="col-md-8">
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="user-input" class="form-label">您的昵称</label>
                <input type="text" class="form-control" id="user-input" placeholder="e.g., 王维">
            </div>
            <div class="col-md-3 mb-3">
                <label for="user-age" class="form-label">年龄</label>
                <input type="number" class="form-control" id="user-age" placeholder="年龄" min="1" max="120">
            </div>
            <div class="col-md-3 mb-3">
                <label for="user-gender" class="form-label">性别</label>
                <select class="form-control" id="user-gender">
                    <option value="">请选择</option>
                    <option value="男">男</option>
                    <option value="女">女</option>
                    <option value="其他">其他</option>
                </select>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="user-education" class="form-label">最高学历</label>
                <select class="form-control" id="user-education">
                    <option value="">请选择</option>
                    <option value="小学">小学</option>
                    <option value="初中">初中</option>
                    <option value="高中">高中</option>
                    <option value="大专">大专</option>
                    <option value="本科">本科</option>
                    <option value="硕士">硕士</option>
                    <option value="博士">博士</option>
                </select>
            </div>
            <div class="col-md-6 mb-3 d-flex align-items-end">
                <button type="button" class="btn btn-primary" id="start-btn">开始</button>
            </div>
        </div>
    </div>
    <div class="col-md-4 text-end d-flex align-items-end justify-content-end flex-column">
        <div id="remaining-count" class="text-muted mb-2">剩余: 0 / 10</div>
        <div id="coverage-metrics" class="text-muted small" style="text-align: right;">
            <div class="coverage-item">加载中...</div>
        </div>
    </div>
</div>

<div id="status-message" class="hidden"></div>

<!-- Limit Extension Modal -->
<div id="limit-extension-modal" class="modal" style="display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5);">
    <div class="modal-dialog modal-dialog-centered" style="position: relative; margin: auto; padding: 20px; width: 90%; max-width: 500px; margin-top: 15%;">
        <div class="modal-content" style="background-color: #ffffff; padding: 25px; border: none; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
            <div class="modal-header" style="margin-bottom: 20px; border-bottom: 1px solid #e0e0e0; padding-bottom: 15px;">
                <h4 class="modal-title" style="margin: 0; font-size: 1.3em; font-weight: 600; color: #333;">评估限制提醒</h4>
            </div>
            <div class="modal-body" style="margin-bottom: 25px;">
                <p id="limit-extension-message" style="margin: 0; font-size: 16px; line-height: 1.6; color: #555;"></p>
            </div>
            <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 12px; border-top: 1px solid #e0e0e0; padding-top: 15px;">
                <button type="button" class="btn btn-secondary" id="limit-extension-no-btn" style="min-width: 100px; padding: 8px 20px;">否</button>
                <button type="button" class="btn btn-primary" id="limit-extension-yes-btn" style="min-width: 100px; padding: 8px 20px;">是</button>
            </div>
        </div>
    </div>
</div>

<div id="evaluation-box" class="hidden">
    <h2>第一阶段：盲评</h2>
    <p id="phase1-question"><strong>Q1. 这首诗摘录最可能代表这张图像？</strong></p>
    
    <div class="row">
        <!-- Left side: Image -->
        <div class="col-md-6" style="position: relative;">
            <div id="image-container"></div>
        </div>
        
        <!-- Right side: Choices -->
        <div class="col-md-6">
            <div id="poem-choices"></div>
        </div>
    </div>
    
    <!-- Phase 1 Additional Questions (q1-2, q1-3) -->
    <div id="phase1-questions" class="mt-4 hidden">
        <h4>请回答以下问题：</h4>
        <div id="phase1-questions-container"></div>
    </div>
    
    <div class="mt-3 d-flex align-items-center gap-3">
        <button type="button" class="btn btn-secondary" id="reveal-btn" disabled>揭示正确答案</button>
        <span id="reveal-answer" class="hidden" style="font-size: 1.1em; font-weight: bold;"></span>
    </div>
    
    <!-- Phase 2: Revealed Evaluation -->
    <div id="phase2-box" class="hidden mt-4">
        <h2>第二阶段：揭示评估</h2>
        <p>（现在显示正确的目标诗与图像。）</p>
        
        <div class="phase2-content-wrapper">
            <!-- Left side: Poem and Questions -->
            <div class="phase2-questions-wrapper">
                <div id="poem-revealed" class="mb-4">
                    <h4 id="poem-title"></h4>
                    <p id="poem-author"></p>
                    <pre id="poem-content" class="poem-content"></pre>
                </div>
                
                <div id="phase2-questions"></div>
                
                <div class="mt-3">
                    <button type="button" class="btn btn-primary" id="submit-btn" disabled>提交评估</button>
                </div>
            </div>
            
            <!-- Right side: Image and Poem (duplicate) -->
            <div class="phase2-image-wrapper">
                <div id="phase2-image-container"></div>
                <div id="poem-revealed-right" class="mb-4 mt-4">
                    <h4 id="poem-title-right"></h4>
                    <p id="poem-author-right"></p>
                    <pre id="poem-content-right" class="poem-content"></pre>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
